{"remainingRequest":"/Users/taozehua/Downloads/软工2大作业/course-learning-frontend/node_modules/_vue-loader@15.9.7@vue-loader/lib/index.js??vue-loader-options!/Users/taozehua/Downloads/软工2大作业/course-learning-frontend/src/views/student/HistoryOrder.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/taozehua/Downloads/软工2大作业/course-learning-frontend/src/views/student/HistoryOrder.vue","mtime":1625946131164},{"path":"/Users/taozehua/Downloads/软工2大作业/course-learning-frontend/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/taozehua/Downloads/软工2大作业/course-learning-frontend/node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/taozehua/Downloads/软工2大作业/course-learning-frontend/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/taozehua/Downloads/软工2大作业/course-learning-frontend/node_modules/_vue-loader@15.9.7@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7Z2V0T3JkZXJzQnlVc2VyLCBwYXlPcmRlcn0gZnJvbSAiQC9hcGkvb3JkZXIiOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJIaXN0b3J5T3JkZXIiLAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjb2xvckxpc3Q6IFsKICAgICAgICAiI0ZGQUI5MSIsCiAgICAgICAgIiMyNkE2OUEiLAogICAgICAgICIjMDM5QkU1IiwKICAgICAgICAiIzU0NkU3QSIsCiAgICAgICAgIiNCMzlEREIiLAogICAgICAgICIjRUY5QTlBIgogICAgICBdLAogICAgICBvcmRlckxpc3Q6IFtdLAogICAgICBkaWFsb2dCdXlQYXk6IGZhbHNlLAogICAgICBkaWFsb2dSZW50UGF5OiBmYWxzZSwKICAgICAgY3VycmVudE9yZGVySWQ6ICIiLAogICAgICBjdXJyZW50T3JkZXJDb3N0OiAiIiwKICAgICAgY3VycmVudE9yZGVyUmVudFRpbWU6ICIiLAogICAgICBzaG93U25hY2tCYXI6IiIsCiAgICAgIHNuYWNrQmFyQ29sb3I6IiIsCiAgICAgIHNuYWNrQmFyTXNnOiIiCiAgICB9OwogIH0sCgogIG1ldGhvZHM6IHsKICAgIGhhbmRsZVN0dWR5KGNvdXJzZUlkKSB7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKGAvc3R1ZGVudC9jb3Vyc2UvJHtjb3Vyc2VJZH1gKTsKICAgIH0sCiAgICBoYW5kbGVSZW50KG9yZGVyKSB7CiAgICAgIHRoaXMuZGlhbG9nUmVudFBheSA9IHRydWUKICAgICAgdGhpcy5jdXJyZW50T3JkZXJDb3N0ID0gb3JkZXIuY29zdAogICAgICB0aGlzLmN1cnJlbnRPcmRlcklkID0gb3JkZXIuaWQKICAgICAgdGhpcy5jdXJyZW50T3JkZXJSZW50VGltZSA9IG9yZGVyLnRpbWUKICAgIH0sCiAgICBoYW5kbGVCdXkob3JkZXIpIHsKICAgICAgdGhpcy5kaWFsb2dCdXlQYXkgPSB0cnVlCiAgICAgIHRoaXMuY3VycmVudE9yZGVyQ29zdCA9IG9yZGVyLmNvc3QKICAgICAgdGhpcy5jdXJyZW50T3JkZXJJZCA9IG9yZGVyLmlkCiAgICB9LAogICAgcGF5KCkgewogICAgICBwYXlPcmRlcih0aGlzLmN1cnJlbnRPcmRlcklkKS50aGVuKHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcy5jb2RlID09PSAwKSB7CiAgICAgICAgICB0aGlzLnNuYWNrQmFyQ29sb3IgPSAiZXJyb3IiOwogICAgICAgICAgdGhpcy5zbmFja0Jhck1zZyA9IHJlcy5tc2c7CiAgICAgICAgICB0aGlzLnNob3dTbmFja0JhciA9IHRydWU7CiAgICAgICAgICB0aGlzLmRpYWxvZyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSkKICAgICAgdGhpcy5kaWFsb2dSZW50UGF5ID0gZmFsc2UKICAgICAgdGhpcy5kaWFsb2dCdXlQYXkgPSBmYWxzZQogICAgfSwKICAgIG9yZGVyVG9SZW50KG9yZGVyKSB7CiAgICAgIHJldHVybiB0aGlzLm9yZGVySXNSZW50KG9yZGVyKSAmJiAhdGhpcy5vcmRlcklzT2sob3JkZXIpOwogICAgfSwKICAgIG9yZGVyVG9CdXkob3JkZXIpIHsKICAgICAgcmV0dXJuIG9yZGVyLnB1cmNoYXNlVHlwZSA9PT0gJ0J1eScgJiYgb3JkZXIuc3RhdHVzICE9PSAxCiAgICB9LAogICAgb3JkZXJJc1JlbnQob3JkZXIpIHsKICAgICAgcmV0dXJuIG9yZGVyLnB1cmNoYXNlVHlwZSA9PT0gJ1JlbnQnCiAgICB9LAogICAgb3JkZXJJc09rKG9yZGVyKSB7CiAgICAgIGlmIChvcmRlci5wdXJjaGFzZVR5cGUgPT09ICJCdXkiICYmIG9yZGVyLnN0YXR1cyA9PT0gMSkKICAgICAgICByZXR1cm4gdHJ1ZQogICAgICBpZiAob3JkZXIucHVyY2hhc2VUeXBlID09PSAnUmVudCcmJiBvcmRlci5zdGF0dXMgPT09IDEpIHsKICAgICAgICBsZXQgbm93ID0gRGF0ZS5wYXJzZShEYXRlKCkpOwogICAgICAgIGxldCBvcmRlckVuZFRpbWUgPSBEYXRlLnBhcnNlKG9yZGVyLmVuZFRpbWUpCiAgICAgICAgaWYgKG9yZGVyRW5kVGltZSA+IG5vdykgewogICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CiAgfSwKCiAgbW91bnRlZCgpIHsKICAgIGNvbnN0IHVpZCA9IHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgidXNlcklkIik7CiAgICBnZXRPcmRlcnNCeVVzZXIodWlkKS50aGVuKHJlcyA9PiB7CiAgICAgIGNvbnNvbGUubG9nKHJlcyk7CiAgICAgIHRoaXMub3JkZXJMaXN0ID0gcmVzIHx8IFtdOwogICAgfSk7CiAgfQp9Owo="},{"version":3,"sources":["HistoryOrder.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"HistoryOrder.vue","sourceRoot":"src/views/student","sourcesContent":["<template>\n  <div>\n    <v-container class=\"ma-8 pa-4\">\n      <v-card\n          v-for=\"o in orderList\"\n          :key=\"o.id\"\n          :color=\"colorList[o.id % colorList.length]\"\n          class=\"ma-8 pa-4\"\n      >\n        <v-card-title class=\"headline\">\n          {{ o.courseName }}\n        </v-card-title>\n\n        <v-card-subtitle class=\"mt-1\">\n          创建时间: {{ o.createTime }}\n        </v-card-subtitle>\n        <v-card-subtitle v-if=\"orderIsRent(o)\" class=\"mt-1\">\n          租用时间: {{ o.time }}\n        </v-card-subtitle>\n        <v-card-actions class=\"pa-0 pl-2\">\n          <v-btn v-if=\"orderIsOk(o)\" text @click=\"handleStudy(o.courseId)\">学习课程</v-btn>\n          <v-btn v-if=\"orderToRent(o)\" text @click=\"handleRent(o)\">支付订单</v-btn>\n          <v-btn v-if=\"orderToBuy(o)\" text @click=\"handleBuy(o)\">支付订单</v-btn>\n        </v-card-actions>\n      </v-card>\n\n      <v-dialog v-model=\"dialogRentPay\" width=\"1000\">\n        <v-card>\n          <v-card-title>支付订单</v-card-title>\n          <v-card-text>租用时间:  {{ currentOrderRentTime }}</v-card-text>\n          <v-card-text>租用费用:  {{ currentOrderCost }}</v-card-text>\n\n          <v-divider></v-divider>\n\n          <v-card-actions>\n            <v-spacer></v-spacer>\n            <v-btn color=\"primary\" text @click=\"pay()\">支付</v-btn>\n            <v-btn color=\"primary\" text @click=\"dialogRentPay=false\">取消</v-btn>\n          </v-card-actions>\n        </v-card>\n      </v-dialog>\n\n      <v-dialog v-model=\"dialogBuyPay\" width=\"1000\">\n        <v-card>\n          <v-card-title>支付订单</v-card-title>\n          <v-card-text>购买费用:{{ currentOrderCost }}</v-card-text>\n\n          <v-divider></v-divider>\n\n          <v-card-actions>\n            <v-spacer></v-spacer>\n            <v-btn color=\"primary\" text @click=\"pay()\">支付</v-btn>\n            <v-btn color=\"primary\" text @click=\"dialogBuyPay=false\">取消</v-btn>\n          </v-card-actions>\n        </v-card>\n      </v-dialog>\n\n      <v-snackbar v-model=\"showSnackBar\" :color=\"snackBarColor\" top>\n        {{ snackBarMsg }}\n      </v-snackbar>\n    </v-container>\n  </div>\n</template>\n\n<script>\nimport {getOrdersByUser, payOrder} from \"@/api/order\";\n\nexport default {\n  name: \"HistoryOrder\",\n  data() {\n    return {\n      colorList: [\n        \"#FFAB91\",\n        \"#26A69A\",\n        \"#039BE5\",\n        \"#546E7A\",\n        \"#B39DDB\",\n        \"#EF9A9A\"\n      ],\n      orderList: [],\n      dialogBuyPay: false,\n      dialogRentPay: false,\n      currentOrderId: \"\",\n      currentOrderCost: \"\",\n      currentOrderRentTime: \"\",\n      showSnackBar:\"\",\n      snackBarColor:\"\",\n      snackBarMsg:\"\"\n    };\n  },\n\n  methods: {\n    handleStudy(courseId) {\n      this.$router.push(`/student/course/${courseId}`);\n    },\n    handleRent(order) {\n      this.dialogRentPay = true\n      this.currentOrderCost = order.cost\n      this.currentOrderId = order.id\n      this.currentOrderRentTime = order.time\n    },\n    handleBuy(order) {\n      this.dialogBuyPay = true\n      this.currentOrderCost = order.cost\n      this.currentOrderId = order.id\n    },\n    pay() {\n      payOrder(this.currentOrderId).then(res => {\n        if (res.code === 0) {\n          this.snackBarColor = \"error\";\n          this.snackBarMsg = res.msg;\n          this.showSnackBar = true;\n          this.dialog = false;\n        }\n      })\n      this.dialogRentPay = false\n      this.dialogBuyPay = false\n    },\n    orderToRent(order) {\n      return this.orderIsRent(order) && !this.orderIsOk(order);\n    },\n    orderToBuy(order) {\n      return order.purchaseType === 'Buy' && order.status !== 1\n    },\n    orderIsRent(order) {\n      return order.purchaseType === 'Rent'\n    },\n    orderIsOk(order) {\n      if (order.purchaseType === \"Buy\" && order.status === 1)\n        return true\n      if (order.purchaseType === 'Rent'&& order.status === 1) {\n        let now = Date.parse(Date());\n        let orderEndTime = Date.parse(order.endTime)\n        if (orderEndTime > now) {\n          return true\n        }\n      }\n      return false\n    }\n  },\n\n  mounted() {\n    const uid = window.localStorage.getItem(\"userId\");\n    getOrdersByUser(uid).then(res => {\n      console.log(res);\n      this.orderList = res || [];\n    });\n  }\n};\n</script>\n"]}]}