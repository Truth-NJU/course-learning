# 软件体系结构文档模板
## 变更记录
负责人|日期|时间|修改部分
-|-|-|-
All|2021/6/30|20:19|创建文档
陈耔为|2021/6/30|22:52|建立大致结构
胡晓通|2021/7/1|12:56|完成逻辑视图
胡晓通|2021/7/1|15:55|完成组合视图
陶泽华|2021/7/1|23:01|完成用户界面层分解
陶泽华|2021/7/2|03:50|完成业务逻辑层分解
丁笑宇|2021/7/2|11:49|完成数据层分解
陈耔为|2021/7/2|12:43|完成信息视角

[TOC]



## 1.引言

### 1.1编制目的

  本报告详细完成对课程学习网站的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员及用户的沟通。

  本报告面向开发人员，测试人员及最终用户而编写，是了解系统的导航。

### 1.2词汇表

|    词汇名称    | 词汇含义     | 备注 |
| :------------: | ------------ | ---- |
| courselearning | 课程学习系统 |      |

### 1.3参考资料

- （1）《软件工程与计算（卷二）软件开发的技术基础》
- （2）课程学习系统需求规格说明文档

## 2.产品概述

### 2.1 项目前景

#### 2.1.1 背景与机遇

- 越来越多的人期望能够更方便的学习自己想要的知识，线上的学习网站就很好的满足了人们这样的需求。
- 线下授课不方便学习者去复习和参考，线上的课程学习系统可以为学习者随时随地提供学习的条件。对于重点难点可以反复的学习。

#### 2.1.2 业务需求

- 产品名称：CourseLearning网课学习平台
- 预期功能：
  - BR1.  系统为学生和老师提供课程展示
  - BR2.  学生能够通过购买或租借的方式学习课程
  - BR3.  学生能够参加老师创建的课程测试
  - BR4.  学生和老师可以进行课程发帖和评论
  - BR5.  教师可以发布、管理课程
- 应用：为渴望知识的人提供一个更加方便的线上学习方式

### 2.2 项目功能

#### 2.2.1 学生相关

- SF1. 可以让学生租用课程。
- SF2. 可以让学生开通会员并使其获得一些特权。
- SF3. 可以让学生作答测试题目。
- SF4. 可以让学生查看测试信息和参加测试的成绩和答案。
- SF5. 可以让学生在每个课程下发布帖子。
- SF6. 可以让学生查看自己的帖子和别人的帖子。
- SF7. 可以让学生回复别人的帖子。

#### 2.2.2 教师相关

- SF8. 可以让教师创建课程相关的题目。
- SF9. 可以让教师创建课程的测试。
- SF10. 可以让教师发布帖子。
- SF11. 可以让教师查看自己和别人的帖子。
- SF12. 可以让教师回复别人的帖子。

### 2.3 用户特征

- 学生：使用课程学习系统来学习的人
- 教师：负责为课程系统创建课程、管理课件的人员


## 3.逻辑视图

- 处理静态设计模型

  - 在课程学习网站中，选择了分层体系结构风格，将系统分为3层（前端展示层、业务逻辑层、数据层）能够很好地示意整个高层抽象。前端展示层包含web页面的实现，业务逻辑层包含业务逻辑处理的实现，数据层负责数据的持久化和访问。

- 分层体系结构的逻辑视角

![](https://img-blog.csdnimg.cn/20210710201821921.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R4eTE4ODYxODQ4NzU2,size_16,color_FFFFFF,t_70)


- 分层体系结构的逻辑设计方案

  ![](https://img-blog.csdnimg.cn/20210710201848345.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R4eTE4ODYxODQ4NzU2,size_16,color_FFFFFF,t_70)


## 4.组合视图

### 4.1开发包图

- 表示软件组件在开发时环境中的静态组织
  - 描述开发包以及相互间的依赖
  - 绘制开发包图
  
  **注意：otherController来自助教开发的controller**

|          开发包          | 依赖的其他开发包                                             |
| :----------------------: | ------------------------------------------------------------ |
|          mainUI          | userCenterUI,courseUI,courseOrderUI,vo,dto                   |
|         courseUI         | CourseTestController,CourseOrderController,PostController,OtherController,界面库类包,vo,dto |
|       userCenterUI       | CourseTestController,VipController,界面库类包,vo,dto         |
|      courseOrderUI       | CourseOrderController,otherController界面库类包,vo,dto       |
|   courseTestController   | CourseTestService,http rest,vo,dto                           |
|      vipController       | VipService,http rest,vo,dto                                  |
|  courseOrderController   | CourseOrderService,http rest,vo,dto                          |
|      postController      | PostService,http rest,vo,dto                                 |
|     otherController      | UserService,CuponService,CourseService,http rest,vo,dto      |
|    courseTestService     |                                                              |
|        vipService        |                                                              |
|    courseOrderService    |                                                              |
|       postService        |                                                              |
|       userService        |                                                              |
|       cuponService       |                                                              |
|      courseService       |                                                              |
|  courseTestServiceImpl   | CourseTestService,UserMapper,CourseTestMapper,CourseQuestionMapper,CourseUserTestQuestionMapper,CourseTestMapper,CourseMapper,CourseTestQuestionMapper,po |
|      vipServiceImpl      | VipService,UserMapper,po                                     |
| courseOrderServiceMapper | CourseOrderService,UserService,CouponService,CourseService,CourseOrderMapper,CourseOrderCouponMapper,po |
|     postServiceImpl      | PostService,PostMapper,ReplyMapper,po                        |
|        userMapper        | Database,po                                                  |
|   courseQuestionMapper   | Database,po                                                  |
|     courseTestMapper     | Database,po                                                  |
|       courseMapper       | Database,po                                                  |
| courseTestQuestionMapper | Database,po                                                  |
|       ReplyMapper        | Database,po                                                  |
|   courseUserTestMapper   | Database,po                                                  |
| courseTestQuestionMapper | Database,po                                                  |
|    courseOrderMapper     | Database,po                                                  |
|        PostMapper        | Database,po                                                  |
|  courseOrerCouponMapper  | Database,po                                                  |
|            vo            |                                                              |
|            po            |                                                              |
|        界面类库包        |                                                              |
|         database         | mySql                                                        |
|        http rest         |                                                              |

- 客户端开发包图：![](https://img-blog.csdnimg.cn/2021071020205940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R4eTE4ODYxODQ4NzU2,size_16,color_FFFFFF,t_70)



- 服务端开发包图：

  ![](https://img-blog.csdnimg.cn/20210710202111227.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R4eTE4ODYxODQ4NzU2,size_16,color_FFFFFF,t_70)


### 4.2运行时进程

- 表示软件在运行时进程间的交互，描述系统的动态结构

- 示意图：

  ![](https://img-blog.csdnimg.cn/img_convert/6774648a0775611d2e8e7d3ba859ab08.png)


### 4.3物理部署

- 处理如何将软件组件映射到硬件基础设施
- 示意图

![icon](https://img-blog.csdnimg.cn/img_convert/8c667b51987fbed1fa37b2eeb36b8223.png)

## 5.架构设计

- 描述功能分解和如何在不同的层中安排软件模块
  - 描述架构中的对象，包含架构图
  - 描述组件接口信息
    - 包括：语法、前置条件、后置条件

### 5.1模块职责

- 模块视图

  - 客户端模块视图

  ![在这里插入图片描述](https://img-blog.csdnimg.cn/202107102026518.png)


  - 服务器端模块视图

    ![在这里插入图片描述](https://img-blog.csdnimg.cn/2021071020260095.png)



- 各层职责

|     层     | 职责                                 |
| :--------: | ------------------------------------ |
|  启动模块  | 负责初始化网络通信机制，启动用户界面 |
|   展示层   | 展示界面                             |
| 业务逻辑层 | 对于用户界面的输入响应和业务处理逻辑 |
|   数据层   | 负责数据的持久化及数据访问接口       |
|  网络模块  | 利用Java RMI机制查找RMI服务          |

- 层之间调用接口

|                             接口                             | 服务调用方       | 服务提供方       |
| :----------------------------------------------------------: | ---------------- | ---------------- |
| CourseTestController<br />VipController<br />CourseOrderController<br />PostController<br />otherController(这些接口来自助教代码) | 客户端展示层     | 客户端业务逻辑层 |
| UserMapper<br />CourseQuestionMapper<br />CourseTestMapper<br />CourseMapper<br />CourseTestQuestionMapper<br />ReplyMapper<br />CourseUserTestMapper<br />CourseUserTestQuestionMapper<br />CourseOrderMapper<br />CourseOrderCouponMapper<br />PostMapper | 客户端业务逻辑层 | 数据层           |

### 5.2用户界面层分解

#### 职责

- 类图
- 接口规范
- 需要的服务接口

|     模块      | 职责                         |
| :-----------: | ---------------------------- |
| userCenterUI  | 进行课程测试、开通会员       |
|   courseUI    | 购买租用课程、课程测试、帖子 |
| courseOrderUI | 课程订单界面                 |

#### 接口规范

**userCenterUI需要的服务**

| 服务名                                      | 服务                                                         |
| ------------------------------------------- | ------------------------------------------------------------ |
| VipController.getVipPriceInfo               | 查看vip的种类（例如日vip、月vip、年vip）                     |
| VipController.chargeVip                     | 充值vip                                                      |
| CourseTestController.createQuestion         | 教师创建用于课程测试的题目                                   |
| CourseTestController.fixQuestion            | 根据questionId更新问题                                       |
| CourseTestController.deleteQuestion         | 根据questionId删除问题                                       |
| CourseTestController.getQuestionsByCourseId | 通过课程的id获得该课程所有的题目                             |
| CourseTestController.getQuestionsByTestId   | 学生根据测试id获取测试的题目（若学生已完成测试，则返回每题的成绩和答案；若学生未做，则仅返回测试题目） |
| CourseTestController.getQuestionsByTestId   | 老师根据测试id获取测试题目的全部信息                         |
| CourseTestController.addTestQuestion        | 教师为通过测试id和问题id测试添加题目                         |
| CourseTestController.finishTest             | 学生完成测试并提交答案                                       |
| CourseTestController.createTest             | 教师创建测试                                                 |
| CourseTestController.fixTest                | 教师更新测试信息                                             |
| CourseTestController.deleteTest             | 教师根据测试id删除测试                                       |
| CourseTestController.getTestsByTeacherId    | 根据教师id获得教师创建的测试列表                             |
| CourseTestController.getTestsByCourseId     | 学生根据课程id获得课程的测试列表，并返回测试的成绩           |
| CourseTestController.getTestsByCourseId     | 教师根据课程id获得测试列表                                   |

**courseUI需要的服务**

| 服务名                                      | 服务                                                         |
| ------------------------------------------- | ------------------------------------------------------------ |
| CourseTestController.createQuestion         | 教师创建用于课程测试的题目                                   |
| CourseTestController.fixQuestion            | 根据questionId更新问题                                       |
| CourseTestController.deleteQuestion         | 根据questionId删除问题                                       |
| CourseTestController.getQuestionsByCourseId | 通过课程的id获得该课程所有的题目                             |
| CourseTestController.getQuestionsByTestId   | 学生根据测试id获取测试的题目（若学生已完成测试，则返回每题的成绩和答案；若学生未做，则仅返回测试题目） |
| CourseTestController.getQuestionsByTestId   | 老师根据测试id获取测试题目的全部信息                         |
| CourseTestController.addTestQuestion        | 教师为通过测试id和问题id测试添加题目                         |
| CourseTestController.finishTest             | 学生完成测试并提交答案                                       |
| CourseTestController.createTest             | 教师创建测试                                                 |
| CourseTestController.fixTest                | 教师更新测试信息                                             |
| CourseTestController.deleteTest             | 教师根据测试id删除测试                                       |
| CourseTestController.getTestsByTeacherId    | 根据教师id获得教师创建的测试列表                             |
| CourseTestController.getTestsByCourseId     | 学生根据课程id获得课程的测试列表，并返回测试的成绩           |
| CourseTestController.getTestsByCourseId     | 教师根据课程id获得测试列表                                   |
| CourseOrderController.createCourseRentOrder | 创建课程租用订单                                             |
| PostController.createPost                   | 发布帖子                                                     |
| PostController.searchPosts                  | 根据课程id查看课程的所有帖子，以分页的形式展示               |
| PostController.deletePost                   | 根据帖子id删除帖子                                           |
| PostController.createReply                  | 回复帖子                                                     |
| PostController.searchReplies                | 查看帖子的所有回复，以分页的形式展示                         |
| PostController.createReply2Reply            | 创建评论的回复                                               |
| PostController.searchReply2Reply            | 查询一个评论的所有回复                                       |
| PostController.searchUserPosts              | 查询一个用户的全部帖子，返回帖子信息以及每个帖子有哪些新回复 |
| PostController.searchUserReplies            | 查询一个用户的全部回复，返回回复信息以及每个回复有哪些新回复 |

**courseOrderUI需要的服务**

| 服务名                                      | 服务             |
| ------------------------------------------- | ---------------- |
| CourseOrderController.createCourseRentOrder | 创建课程租用订单 |

### 5.3业务逻辑层分解

#### 5.3.1	CourseTestServiceImpl模块

1. 模块概述

   CourseTestServiceImpl模块承担的需求

   1. 为课程创建测试题目
   2. 根据课程id查询课程所有的测试题目
   3. 学生根据测试id获取测试的题目（若学生已完成测试，则返回每题的成绩和答案；若学生未做，则仅返回测试题目）
   4. 根据questionId更新问题
   5. 根据questionId删除问题
   6. 教师删除测试
   7. 教师更新测试信息
   8. 查询测试状态
   9. 教师创建测试
   10. 学生根据课程id获得课程的测试列表，并返回测试的成绩
   11. 教师根据课程id获得测试列表
   12. 根据教师id获得全部教师创建的测试
   13. 学生完成测试并提交答案
   14. 教师通过测试id和问题id为测试添加题目
   15. 教师通过测试id和问题id为测试删除题目

2. 整体结构

   根据体系结构的设计，我们将系统分为了展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，我们添加了接口。展示层和业务逻辑层之间，我们添加CourseTestService接口。业务逻辑层和数据层之间添加CourseTestMapper接口。由CourseTestController作为前后端的连接点。

   

   CourseTestServiceImpl模块各个类的职责

   | 模块                 | 职责                               |
   | -------------------- | ---------------------------------- |
   | CourseTestController | 负责课程测试操作所需要的服务       |
   | CourseTestService    | 负责课程测试操作所需要的服务的实现 |

   

3. 模块内部类的接口规范

   CourseTestService的接口规范

   | 接口名                           | 语法     | ResultVO<CourseQuestionVO> createQuestion(CourseQuestionDTO courseQuestionDTO); |
   | -------------------------------- | -------- | ------------------------------------------------------------ |
   | CourseTestService.createQuestion | 前置条件 | VO和DTO符合规范                                              |
   |                                  | 后置条件 | 调用ucourseQuestionMapper.createQuestion方法                 |

   

   | 接口名                                   | 语法     | ResultVO<List<CourseQuestionVO>> getQuestionsByCourseId(int courseId); |
   | ---------------------------------------- | -------- | ------------------------------------------------------------ |
   | CourseTestService.getQuestionsByCourseId | 前置条件 | courseId必须在数据库中存在                                   |
   |                                          | 后置条件 | 调用courseQuestionMapper.selectQuestionByCourseId方法并返回一个列表 |

   

   | 接口名                                 | 语法     | ResultVO<List<CourseQuestionVO>> getQuestionsByTestId(int testId, int userId); |
   | -------------------------------------- | -------- | ------------------------------------------------------------ |
   | CourseTestService.getQuestionsByTestId | 前置条件 | userId和testId在数据库中存在                                 |
   |                                        | 后置条件 | 调用ucourseQuestionMapper.selectQuestionByTestId、courseTestMapper.findMyScore和courseUserTestQuestionMapper.selectTestQuestions方法 |

   

   | 接口名                                 | 语法     | ResultVO<List<CourseQuestionVO>> getQuestionsByTestId(int testId) |
   | -------------------------------------- | -------- | ------------------------------------------------------------ |
   | CourseTestService.getQuestionsByTestId | 前置条件 | testId在数据库里存在                                         |
   |                                        | 后置条件 | 调用courseQuestionMapper.selectQuestionByTestId方法          |

   | 接口名                        | 语法     | ResultVO<CourseQuestionVO> fixQuestion(CourseQuestionDTO courseQuestionDTO); |
   | ----------------------------- | -------- | ------------------------------------------------------------ |
   | CourseTestService.fixQuestion | 前置条件 | DTO中的questionId在数据库里存在                              |
   |                               | 后置条件 | 调用courseQuestionMapper.updateQuestion方法                  |

   | 接口名                           | 语法     | ResultVO deleteQuestion(CourseQuestionDTO courseQuestionDTO); |
   | -------------------------------- | -------- | ------------------------------------------------------------ |
   | CourseTestService.deleteQuestion | 前置条件 | DTO中的questionId在数据库里存在                              |
   |                                  | 后置条件 | 调用courseQuestionMapper.deleteQuestion方法                  |

   | 接口名                       | 语法     | ResultVO deleteTest(CourseTestDTO courseTestDTO); |
   | ---------------------------- | -------- | ------------------------------------------------- |
   | CourseTestService.deleteTest | 前置条件 | DTO中的testId在数据库里存在                       |
   |                              | 后置条件 | 调用courseTestMapper.deleteTest方法               |

   | 接口名                    | 语法     | ResultVO<CourseTestVO> fixTest(CourseTestDTO courseTestDTO); |
   | ------------------------- | -------- | ------------------------------------------------------------ |
   | CourseTestService.fixTest | 前置条件 | DTO中的testId在数据库里存在                                  |
   |                           | 后置条件 | 调用courseTestMapper.updateTest方法                          |

   | 接口名                       | 语法     | ResultVO<CourseTestVO> createTest(CourseTestDTO courseTestDTO); |
   | ---------------------------- | -------- | ------------------------------------------------------------ |
   | CourseTestService.createTest | 前置条件 | DTO符合规范                                                  |
   |                              | 后置条件 | 调用courseTestMapper.createTest方法                          |

   | 接口名                               | 语法     | ResultVO<List<CourseTestVO>> getTestsByCourseId(int courseId); |
   | ------------------------------------ | -------- | ------------------------------------------------------------ |
   | CourseTestService.getTestsByCourseId | 前置条件 | courseId在数据库里存在                                       |
   |                                      | 后置条件 | 调用 courseTestMapper.findAllTest和courseTestMapper.updateTest方法 |

   | 接口名                               | 语法     | ResultVO<List<CourseTestVO>> getTestsByCourseId(int courseId, int userId); |
   | ------------------------------------ | -------- | ------------------------------------------------------------ |
   | CourseTestService.getTestsByCourseId | 前置条件 | courseId和userId在数据库里存在                               |
   |                                      | 后置条件 | 调用 courseTestMapper.findAllTest和courseTestMapper.updateTest和courseTestMapper.findMyScore方法 |

   | 接口名                                | 语法     | ResultVO<List<CourseTestVO>> getTestsByTeacherId(int teacherId); |
   | ------------------------------------- | -------- | ------------------------------------------------------------ |
   | CourseTestService.getTestsByTeacherId | 前置条件 | teacherId在数据库里存在                                      |
   |                                       | 后置条件 | 调用 courseMapper.selectByTeacherId方法                      |

   | 接口名                       | 语法     | ResultVO<CourseTestFinishVO> finishTest(CourseTestFinishDTO courseTestFinishDTO); |
   | ---------------------------- | -------- | ------------------------------------------------------------ |
   | CourseTestService.finishTest | 前置条件 | DTO符合规范                                                  |
   |                              | 后置条件 | 调用 userMapper.selectByPrimaryKey、courseUserTestMapper.finishTest、courseUserTestQuestionMapper.finishTestQuestions方法 |

   | 接口名                            | 语法     | ResultVO<List<CourseTestQuestionPO>> addTestQuestion(CourseTestQuestionAddDTO courseTestQuestionAddDTO); |
   | --------------------------------- | -------- | ------------------------------------------------------------ |
   | CourseTestService.addTestQuestion | 前置条件 | testId和questionId在数据库里存在                             |
   |                                   | 后置条件 | 调用courseTestQuestionMapper.addTestQuestion方法             |

   | 接口名                               | 语法     | ResultVO deleteTestQuestion(CourseTestQuestionDeleteDTO courseTestQuestionDeleteDTO); |
   | ------------------------------------ | -------- | ------------------------------------------------------------ |
   | CourseTestService.deleteTestQuestion | 前置条件 | testId和questionId在数据库里存在                             |
   |                                      | 后置条件 | 调用courseTestQuestionMapper.deleteTestQuestion方法          |

4. 业务逻辑层的设计原理

   利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的Service。

   

#### 5.3.2	CourseOrderServiceImpl模块

1. 模块概述

   CourseOrderServiceImpl模块承担的需求

   1. 创建租用课程订单

2. 整体结构

   根据体系结构的设计，我们将系统分为了展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，我们添加了接口。展示层和业务逻辑层之间，我们添加CourseOrderService接口。业务逻辑层和数据层之间添加CourseOrderMapper接口。由CourseOrderController作为前后端的连接点。

   

   CourseOrderServiceImpl模块各个类的职责

   | 模块                  | 职责                               |
   | --------------------- | ---------------------------------- |
   | CourseOrderController | 负责订单相关操作所需要的服务       |
   | CourseOrderService    | 负责订单相关操作所需要的服务的实现 |

   

3. 模块内部类的接口规范

   CourseOrderService的接口规范

   | 接口名                                  | 语法     | ResultVO<CourseOrderVO> createCourseRentOrder(OrderRentDTO orderRentDTO); |
   | --------------------------------------- | -------- | ------------------------------------------------------------ |
   | CourseOrdeService.createCourseRentOrder | 前置条件 | 当前用户未长期购买过此课程，且没有上一笔未支付的订单         |
   |                                         | 后置条件 | 调用orderMapper.selectByUserId、orderMapper.queryMostRecentOrder和orderMapper.insert方法 |

4. 业务逻辑层的设计原理

   利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的Service。

#### 5.3.3	PostServiceImpl模块

1. 模块概述

   PostServiceImpl模块承担的需求

   1. 发布帖子
   2. 删除帖子
   3. 查询一个课程的所有帖子
   4. 查询一个帖子的所有回复
   5. 发布回复
   6. 创建对一个评论的回复
   7. 查询一个评论的所有回复
   8. 查询用户发过的所有的帖子
   9. 查询用户发过的所有的回复

2. 整体结构

   根据体系结构的设计，我们将系统分为了展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，我们添加了接口。展示层和业务逻辑层之间，我们添加PostService 接口。业务逻辑层和数据层之间添加PostMapper接口。由PostController作为前后端的连接点。

   

   PostServiceImpl模块各个类的职责

   | 模块           | 职责                           |
   | -------------- | ------------------------------ |
   | PostController | 负责帖子操作所需要的服务       |
   | PostService    | 负责帖子操作所需要的服务的实现 |

   

3. 模块内部类的接口规范

   PostService 的接口规范

   | 接口名                  | 语法     | ResultVO<PostVO> createPost(PostDTO postDTO); |
   | ----------------------- | -------- | --------------------------------------------- |
   | PostService .createPost | 前置条件 | DTO符合规范                                   |
   |                         | 后置条件 | 调用postMapper.addPost方法                    |

   

   | 接口名                  | 语法     | ResultVO deletePost(PostDTO postDTO); |
   | ----------------------- | -------- | ------------------------------------- |
   | PostService .deletePost | 前置条件 | DTO中的postId在数据库中存在           |
   |                         | 后置条件 | 调用postMapper.deletePost方法         |

   

   | 接口名                   | 语法     | PageInfo<PostVO> searchPosts(int courseId, int pageNo,int number) |
   | ------------------------ | -------- | ------------------------------------------------------------ |
   | PostService .searchPosts | 前置条件 | courseId在数据库中存在                                       |
   |                          | 后置条件 | 调用postMapper.selectPostByCourseId方法，分页后返回          |

   | 接口名                     | 语法     | PageInfo<ReplyVO> searchReplies(int postId,int userId, int pageNo,int number) |
   | -------------------------- | -------- | ------------------------------------------------------------ |
   | PostService .searchReplies | 前置条件 | postId在数据库中存在                                         |
   |                            | 后置条件 | 调用replyMapper.selectReplyByPostId方法，分页后返回          |

   | 接口名                   | 语法     | ResultVO<ReplyVO> createReply(ReplyDTO replyDTO) |
   | ------------------------ | -------- | ------------------------------------------------ |
   | PostService .createReply | 前置条件 | DTO符合规范                                      |
   |                          | 后置条件 | 调用replyMapper.reply方法                        |

   | 接口名                         | 语法     | ResultVO<ReplyVO> createReply2Reply(ReplyDTO replyDTO) |
   | ------------------------------ | -------- | ------------------------------------------------------ |
   | PostService .createReply2Reply | 前置条件 | DTO符合规范                                            |
   |                                | 后置条件 | 调用replyMapper.replyReply方法                         |

   

   | 接口名                         | 语法     | PageInfo<ReplyVO> searchReply2Reply(int repliedId,int userId, int pageNo,int number) |
   | ------------------------------ | -------- | ------------------------------------------------------------ |
   | PostService .searchReply2Reply | 前置条件 | repliedId在数据库中存在                                      |
   |                                | 后置条件 | 调用replyMapper.selectReplyByRepliedId方法，分页后返回       |

   | 接口名                       | 语法     | PageInfo<PostVO> searchUserPosts(int userId,int pageNo,int number) |
   | ---------------------------- | -------- | ------------------------------------------------------------ |
   | PostService .searchUserPosts | 前置条件 | userId在数据库中存在                                         |
   |                              | 后置条件 | 调用postMapper.selectPostByUserId方法，分页后返回            |

   | 接口名                         | 语法     | PageInfo<ReplyVO> searchUserReplies(int userId,int pageNo,int number) |
   | ------------------------------ | -------- | ------------------------------------------------------------ |
   | PostService .searchUserReplies | 前置条件 | userId在数据库中存在                                         |
   |                                | 后置条件 | 调用replyMapper.selectReplyByUserId方法，分页后返回          |

4. 业务逻辑层的设计原理

   利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的Service。

#### 5.3.4	VipServiceImpl模块

1. 模块概述

   VipServiceImpl模块承担的需求

   1. 用户查看各种vip的价格
   2. 用户购买vip

2. 整体结构

   根据体系结构的设计，我们将系统分为了展示层、业务逻辑层、数据层。每一层之间为了增加灵活性，我们添加了接口。展示层和业务逻辑层之间，我们添加VipService接口。业务逻辑层和数据层之间添加UserMapper接口。由VipController作为前后端的连接点。

   

   VipServiceImpl模块各个类的职责

   | 模块           | 职责                               |
   | -------------- | ---------------------------------- |
   | VipController  | 负责开通会员操作所需要的服务       |
   | VipServiceImpl | 负责开通会员操作所需要的服务的实现 |

   

3. 模块内部类的接口规范

   VipService的接口规范

   | 接口名                     | 语法     | ResultVO<List<VipInfoVO>> getVipPriceInfo(); |
   | -------------------------- | -------- | -------------------------------------------- |
   | VipService.getVipPriceInfo | 前置条件 | 无                                           |
   |                            | 后置条件 | 调用SimpleVipFactory.getVipPrice()方法并返回 |

   

   | 接口名            | 语法     | ResultVO<VipChargeVO> getVip(VipChargeDTO vipChargeDTO)      |
   | ----------------- | -------- | ------------------------------------------------------------ |
   | VipService.getVip | 前置条件 | DTO符合规范，userId存在                                      |
   |                   | 后置条件 | 调用 userMapper.selectByPrimaryKey、userMapper.updateByPrimaryKey和userMapper.decreaseBalance并返回 |

4. 业务逻辑层的设计原理

   利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的Service。

### 5.4数据层分解

#### 职责

| 模块                          | 职责                                                         |
| ----------------------------- | ------------------------------------------------------------ |
| CourseQuestionMapper          | 基于CourseQuestion的持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| CourseOrderMapper             | 基于CourseOrder的持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| CourseTestMapper              | 基于CourseTest的持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| CourseTestQuestionMapper      | 基于CourseTestQuestion的持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| CourseUserTestMapper          | 基于CourseUserTest的持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| CourseUserTest QuestionMapper | 基于CourseUserTestQuestion的持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| PostMapper                    | 基于Post的持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| ReplyMapper                   | 基于Reply的持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |
| UserMapper                    | 基于User的持久化数据库的接口，提供集体载入、集体保存、增、删、改、查服务 |

#### 接口规范

##### CourseQuestionMapper

| 接口名                              | 语法         | int createQuestion(CourseQuestionPO courseQuestionPO); |
| ----------------------------------- | :----------- | ------------------------------------------------------ |
| CourseQuestionMapper.createQuestion | **前置条件** | PO符合规范                                             |
|                                     | **后置条件** | 创建一个课程测试                                       |

| 接口名                              | 语法         | int deleteQuestion(int questionId); |
| ----------------------------------- | :----------- | ----------------------------------- |
| CourseQuestionMapper.deleteQuestion | **前置条件** | questionId在数据库中存在            |
|                                     | **后置条件** | 删除一个question                    |

| 接口名                                          | 语法         | CourseQuestionPO  selectQuestionByQuestionId(int questionId); |
| ----------------------------------------------- | :----------- | ------------------------------------------------------------ |
| CourseQuestionMapper.selectQuestionByQuestionId | **前置条件** | questionId在数据库中存在                                     |
|                                                 | **后置条件** | 按questionId查找并返回相应的题目结果                         |

| 接口名                                      | 语法         | List<CourseQuestionPO> selectQuestionByTestId(int testId); |
| ------------------------------------------- | :----------- | ---------------------------------------------------------- |
| CourseQuestionMapper.selectQuestionByTestId | **前置条件** | testId在数据库中存在                                       |
|                                             | **后置条件** | 按testId查找并返回相应的题目列表结果                       |

| 接口名                                        | 语法         | List<CourseQuestionPO> selectQuestionByCourseId(int courseId); |
| --------------------------------------------- | :----------- | ------------------------------------------------------------ |
| CourseQuestionMapper.selectQuestionByCourseId | **前置条件** | courseId在数据库中存在                                       |
|                                               | **后置条件** | 按courseId查找并返回相应课程的题目列表                       |

| 接口名                              | 语法         | int updateQuestion(CourseQuestionPO courseQuestionPO); |
| ----------------------------------- | :----------- | ------------------------------------------------------ |
| CourseQuestionMapper.updateQuestion | **前置条件** | questionId在数据库中存在                               |
|                                     | **后置条件** | 按questionId更新对应的题目                             |

| 接口名                         | 语法         | int addAnswer(CourseUserTestQuestionPO courseUserTestQuestionPO); |
| ------------------------------ | :----------- | ------------------------------------------------------------ |
| CourseQuestionMapper.addAnswer | **前置条件** | userId、testId和questionId在数据库中存在                     |
|                                | **后置条件** | 按userId、testId和questionId添加对应学生测试题目的答案       |

| 接口名                            | 语法         | int updateAnswer(CourseUserTestQuestionPO courseUserTestQuestionPO); |
| --------------------------------- | :----------- | ------------------------------------------------------------ |
| CourseQuestionMapper.updateAnswer | **前置条件** | userId、testId和questionId在数据库中存在                     |
|                                   | **后置条件** | 按userId、testId和questionId更新对应学生测试题目的答案       |

##### CourseTestMapper

| 接口名                       | 语法         | int createTest(CourseTestPO courseTestPO); |
| ---------------------------- | :----------- | ------------------------------------------ |
| CourseTestMapper. createTest | **前置条件** | PO符合规范                                 |
|                              | **后置条件** | 创建一个新的测试                           |

| 接口名                       | 语法         | int deleteTest(int testId); |
| ---------------------------- | :----------- | --------------------------- |
| CourseTestMapper. deleteTest | **前置条件** | testId在数据库中存在        |
|                              | **后置条件** | 根据testId删除一个测试      |

| 接口名                        | 语法         | List<CourseTestPO>  findAllTest(int courseId); |
| ----------------------------- | :----------- | ---------------------------------------------- |
| CourseTestMapper. findAllTest | **前置条件** | courseId在数据库中存在                         |
|                               | **后置条件** | 按courseId查找并返回相应的课程测试列表         |

| 接口名                        | 语法         | CourseUserTestPO findMyScore(CourseUserTestPO courseUserTestPO); |
| ----------------------------- | :----------- | ------------------------------------------------------------ |
| CourseTestMapper. findMyScore | **前置条件** | userId和testId在user_test表中存在                            |
|                               | **后置条件** | 按UserId和testId查找用户某次测试的分数                       |

##### CourseTestQuestionMapper

| 接口名                                    | 语法         | void addTestQuestion(List<CourseTestQuestionPO> courseTestQuestionPOS); |
| ----------------------------------------- | :----------- | ------------------------------------------------------------ |
| CourseTestQuestionMapper. addTestQuestion | **前置条件** | testId和questionId在数据库中存在                             |
|                                           | **后置条件** | 为测试添加题目                                               |

| 接口名                                       | 语法         | int deleteTestQuestion(int testId, int questionId); |
| -------------------------------------------- | :----------- | --------------------------------------------------- |
| CourseTestQuestionMapper. deleteTestQuestion | **前置条件** | testI和questionId在数据库中存在                     |
|                                              | **后置条件** | 删除一个测试的某个题目                              |

##### CourseUserTestMapper

| 接口名                           | 语法         | void finishTest(CourseUserTestPO courseUserTestPO); |
| -------------------------------- | :----------- | --------------------------------------------------- |
| CourseUserTestMapper. finishTest | **前置条件** | PO符合规范                                          |
|                                  | **后置条件** | 将参与测试的用户id和测试id加入user_test表           |

| 接口名                           | 语法         | void updateTest(CourseUserTestPO courseUserTestPO); |
| -------------------------------- | :----------- | --------------------------------------------------- |
| CourseUserTestMapper. updateTest | **前置条件** | testId和userId在数据库中存在                        |
|                                  | **后置条件** | 更新一个用户某个测试的分数                          |

##### CourseUserTestQuestionMapper

| 接口名                                            | 语法         | void finishTestQuestions(List<CourseUserTestQuestionPO> courseUserTestQuestionPOS); |
| ------------------------------------------------- | :----------- | ------------------------------------------------------------ |
| CourseUserTestQuestionMapper. finishTestQuestions | **前置条件** | userId、testId和questionId在数据库中存在                     |
|                                                   | **后置条件** | 按userId、testId和questionId添加对应学生测试题目的答案       |

| 接口名                                            | 语法         | void updateTestQuestions( List<CourseUserTestQuestionPO> courseUserTestQuestionPOS); |
| ------------------------------------------------- | :----------- | ------------------------------------------------------------ |
| CourseUserTestQuestionMapper. updateTestQuestions | **前置条件** | userId、testId和questionId在数据库中存在                     |
|                                                   | **后置条件** | 按userId、testId和questionId更新对应学生测试题目的答案       |

| 接口名                                            | 语法         | List<CourseUserTestQuestionPO> selectTestQuestions(CourseUserTestPO courseUserTestPO); |
| ------------------------------------------------- | :----------- | ------------------------------------------------------------ |
| CourseUserTestQuestionMapper. selectTestQuestions | **前置条件** | userId、testId在数据库中存在                                 |
|                                                   | **后置条件** | 按userId、testId查找对应学生测试题目的答案                   |

##### CourseOrderMapper

| 接口名                                | 语法         | CourseOrder selectPurchaseType(CourseOrder courseOrder); |
| ------------------------------------- | :----------- | -------------------------------------------------------- |
| CourseOrderMapper. selectPurchaseType | **前置条件** | user_id 和 course_id在数据库中存在                       |
|                                       | **后置条件** | 根据user_id 和 course_id 获得最近的订单的purchaseType    |

| 接口名                           | 语法         | CourseOrder selectEndTime(CourseOrder courseOrder); |
| -------------------------------- | :----------- | --------------------------------------------------- |
| CourseOrderMapper. selectEndTime | **前置条件** | user_id 和 course_id在数据库中存在                  |
|                                  | **后置条件** | 根据user_id 和 course_id 获得最大的end_time         |

##### PostMapper

| 接口名              | 语法         | int addPost(PostPO postPO); |
| ------------------- | :----------- | --------------------------- |
| PostMapper. addPost | **前置条件** | PO符合规范                  |
|                     | **后置条件** | 创建一个帖子                |

| 接口名                 | 语法         | int updatePost(PostPO postPO); |
| ---------------------- | :----------- | ------------------------------ |
| PostMapper. updatePost | **前置条件** | postId在数据库中存在           |
|                        | **后置条件** | 根据postId 更新帖子内容        |

| 接口名                 | 语法         | int deletePost(int postId); |
| ---------------------- | :----------- | --------------------------- |
| PostMapper. deletePost | **前置条件** | postId在数据库中存在        |
|                        | **后置条件** | 根据postId 删除帖子         |

| 接口名                           | 语法         | List<PostPO> selectPostByCourseId(int courseId); |
| -------------------------------- | :----------- | ------------------------------------------------ |
| PostMapper. selectPostByCourseId | **前置条件** | courseId在数据库中存在                           |
|                                  | **后置条件** | 根据courseId查看讨论区帖子内容                   |

| 接口名                         | 语法         | List<PostPO> selectPostByUserId(int userId); |
| ------------------------------ | :----------- | -------------------------------------------- |
| PostMapper. selectPostByUserId | **前置条件** | userId在数据库中存在                         |
|                                | **后置条件** | 根据用户id查看用户发布的帖子                 |

| 接口名                         | 语法         | PostPO selectPostByPostId(int postId); |
| ------------------------------ | :----------- | -------------------------------------- |
| PostMapper. selectPostByPostId | **前置条件** | postId在数据库中存在                   |
|                                | **后置条件** | 根据帖子id查看帖子内容                 |

##### ReplyMapper

| 接口名             | 语法         | int reply(ReplyPO replyPO); |
| ------------------ | :----------- | --------------------------- |
| ReplyMapper. reply | **前置条件** | PO符合规范                  |
|                    | **后置条件** | 创建一个回复                |

| 接口名                   | 语法         | int updateReply(ReplyPO replyPO); |
| ------------------------ | :----------- | --------------------------------- |
| ReplyMapper. updateReply | **前置条件** | replyId在数据库中存在             |
|                          | **后置条件** | 根据replyId 更新回复内容          |

| 接口名                  | 语法         | int replyReply(ReplyPO replyPO); |
| ----------------------- | :----------- | -------------------------------- |
| ReplyMapper. replyReply | **前置条件** | replyId在数据库中存在            |
|                         | **后置条件** | 根据replyId回复评论              |

| 接口名                              | 语法         | List<ReplyPO> selectReplyByRepliedId(int repliedId); |
| ----------------------------------- | :----------- | ---------------------------------------------------- |
| ReplyMapper. selectReplyByRepliedId | **前置条件** | repliedId在数据库中存在                              |
|                                     | **后置条件** | 根据repliedId找reply                                 |

| 接口名                    | 语法         | int updateStatus(int replyId); |
| ------------------------- | :----------- | ------------------------------ |
| ReplyMapper. updateStatus | **前置条件** | replyId在数据库中存在          |
|                           | **后置条件** | 更新回复是否已经被查看过的状态 |

| 接口名                   | 语法         | int deleteReply(int replyId); |
| ------------------------ | :----------- | ----------------------------- |
| ReplyMapper. deleteReply | **前置条件** | replyId在数据库中存在         |
|                          | **后置条件** | 根据回复id删除回复            |

| 接口名                           | 语法         | List<ReplyPO> selectReplyByUserId(int userId); |
| -------------------------------- | :----------- | ---------------------------------------------- |
| ReplyMapper. selectReplyByUserId | **前置条件** | userId在数据库中存在                           |
|                                  | **后置条件** | 根据评论发出者的userid找评论                   |

| 接口名                           | 语法         | List<ReplyPO> selectReplyByPostId(int postId); |
| -------------------------------- | :----------- | ---------------------------------------------- |
| ReplyMapper. selectReplyByPostId | **前置条件** | postId在数据库中存在                           |
|                                  | **后置条件** | 根据postID查询回复并按时间从大到小输出         |

##### UserMapper

| 接口名            | 语法         | int updateByPrimaryKey(User record); |
| ----------------- | :----------- | ------------------------------------ |
| UserMapper. reply | **前置条件** | userId在数据库中存在                 |
|                   | **后置条件** | 根据用户id更新用户账号信息           |

| 接口名                         | 语法         | User selectByPrimaryKey(Integer id); |
| ------------------------------ | :----------- | ------------------------------------ |
| UserMapper. selectByPrimaryKey | **前置条件** | id在数据库中存在                     |
|                                | **后置条件** | 根据用户id查看用户账号信息           |

| 接口名                | 语法         | List<User> selectAll(); |
| --------------------- | :----------- | ----------------------- |
| UserMapper. selectAll | **前置条件** | 无                      |
|                       | **后置条件** | 查看所有用户的账号信息  |

## 6.信息视角

- 描述数据持久化对象(PO)

  - 属性及其定义

    1. **CourseQuestionPO类**

       包含了课程id、题目id、题干、题目答案、题目解析、题目类型

       ```java
       @Getter
       @Setter
       public class CourseQuestionPO {
           // 题目编号
           Integer questionId;
           // 题干
           String question;
           // 题目答案
           String answer;
           // 题目解析
           String analysis;
           // 课程id
           Integer courseId;
           // 题目类型
           QuestionType questionType;
       
           public CourseQuestionPO() {
           }
       
           @Override
           public String toString() {
               return "CourseQuestionPO{" +
                       "questionId=" + questionId +
                       ", question='" + question + '\'' +
                       ", answer='" + answer + '\'' +
                       ", analysis='" + analysis + '\'' +
                       ", courseId=" + courseId +
                       ", questionType=" + questionType +
                       '}';
           }
       
           public CourseQuestionPO(Integer questionId, String question, String answer, String analysis, Integer courseId, QuestionType questionType) {
               this.questionId = questionId;
               this.question = question;
               this.answer = answer;
               this.analysis = analysis;
               this.courseId = courseId;
               this.questionType = questionType;
           }
       
       
           public CourseQuestionPO(CourseQuestionDTO courseQuestionDTO) {
               this.questionId = courseQuestionDTO.getQuestionId();
               this.question = courseQuestionDTO.getQuestion();
               this.answer = courseQuestionDTO.getQuestionAnswer();
               this.analysis = courseQuestionDTO.getQuestionAnalysis();
               this.courseId =courseQuestionDTO.getCourseId();
               this.questionType =courseQuestionDTO.getQuestionType();
           }
       
       }
       ```
       
    2. **CourseTestPO类**
    
       包含测试id、测试开始时间、测试结束时间、课程id、测试名字、测试状态
    
       ```java
       @Getter
       @Setter
       public class CourseTestPO {
       
           Integer testId;
       
           Date startTime;
       
           Date endTime;
       
           Integer courseId;
       
           String testName;
       
           TestStatus testStatus;
       
           public CourseTestPO() {
           }
       
           public CourseTestPO(Integer testId, Date startTime, Date endTime, Integer courseId, String testName, TestStatus testStatus) {
               this.testId = testId;
               this.startTime = startTime;
               this.endTime = endTime;
               this.courseId = courseId;
               this.testName = testName;
               this.testStatus = testStatus;
           }
       
           public CourseTestPO(CourseTestDTO courseTestDTO) {
               testId = courseTestDTO.getTestId();
               startTime = courseTestDTO.getStartTime();
               endTime = courseTestDTO.getEndTime();
               courseId = courseTestDTO.getCourseId();
               testName = courseTestDTO.getTest();
           }
       
       
       }
       ```
       
    3. **CourseTestQuestionPO类**
    
       包含测试id、题目id
    
       ```java
       @Getter
       @Setter 
       public class CourseTestQuestionPO {
       
           int testId;
       
           int questionId;
       
           public int getTestId() {
               return testId;
           }
       
           public void setTestId(int testId) {
               this.testId = testId;
           }
       
           public int getQuestionId() {
               return questionId;
           }
       
           public void setQuestionId(int questionId) {
               this.questionId = questionId;
           }
       
           public CourseTestQuestionPO() {
           }
       
           public static List<CourseTestQuestionPO> transferFromDTO(CourseTestQuestionAddDTO courseTestQuestionAddDTO) {
               List<CourseTestQuestionPO> courseTestQuestionPOList = new ArrayList<>();
               for (Integer questionId : courseTestQuestionAddDTO.getQuestionIdList()) {
                   courseTestQuestionPOList.add(new CourseTestQuestionPO(courseTestQuestionAddDTO.getTestId(),questionId));
               }
               return courseTestQuestionPOList;
           }
       
           public CourseTestQuestionPO(int testId, int questionId) {
               this.testId = testId;
               this.questionId = questionId;
           }
       
           public CourseTestQuestionPO(CourseTestQuestionVO courseTestQuestionVO) {
               this.testId = courseTestQuestionVO.getTestId();
               this.questionId = courseTestQuestionVO.getQuestionId();
           }
       
       }
       
       ```
       
    4. **CourseUserTestPO类**
    
       包含用户id、测试id、测试分数
    
       ```java
       @Getter
       @Setter
       public class CourseUserTestPO {
       
           // 用户id
           int userId;
           // 测试id
           int testId;
           // 用户测试的分数
           int score;
       
       
           public CourseUserTestPO() {
           }
       
           public CourseUserTestPO(int userId, int testId, int score) {
               this.userId = userId;
               this.testId = testId;
               this.score = score;
           }
       
           public CourseUserTestPO(int userId, int testId) {
               this.userId = userId;
               this.testId = testId;
           }
       
           public int getUserId() {
               return userId;
           }
       
           public void setUserId(int userId) {
               this.userId = userId;
           }
       
           public int getTestId() {
               return testId;
           }
       
           public void setTestId(int testId) {
               this.testId = testId;
           }
       
           public int getScore() {
               return score;
           }
       
           public void setScore(int score) {
               this.score = score;
           }
       
       
           public CourseUserTestPO(CourseTestFinishDTO courseTestFinishDTO) {
               this.userId = courseTestFinishDTO.getUserId();
               this.testId = courseTestFinishDTO.getTestId();
           }
       
           public CourseUserTestPO(CourseUserTestVO courseUserTestVO) {
               this.userId =courseUserTestVO.getUserId();
               this.testId = courseUserTestVO.getTestId();
               this.score = courseUserTestVO.getScore();
           }
       
       }
       
       ```
    
    5. **CourseUserTestQuestionPO类**
    
       包含用户id、题目id、测试id、用户答案、答案正确性
    
       ```java
       @Getter
       @Setter
       public class CourseUserTestQuestionPO {
       
           // 用户id
           int userId;
           // 用户作答的题目id
           int questionId;
           // 测试id
           int testId;
           // 用户的答案
           String answer;
           // 答案正确与否 0错误，1正确
           int userOx;
       
           public CourseUserTestQuestionPO() {
       
           }
       
           public CourseUserTestQuestionPO(int userId, int questionId, int testId, String answer, int userOx) {
               this.userId = userId;
               this.questionId = questionId;
               this.testId = testId;
               this.answer = answer;
               this.userOx = userOx;
           }
       
           @Override
           public String toString() {
               return "CourseUserTestQuestionPO{" +
                       "userId=" + userId +
                       ", questionId=" + questionId +
                       ", testId=" + testId +
                       ", answer='" + answer + '\'' +
                       ", userOx=" + userOx +
                       '}';
           }
       
           public static List<CourseUserTestQuestionPO> transferFromDTO(CourseTestFinishDTO courseTestFinishDTO) {
               List<CourseUserTestQuestionPO> courseUserTestQuestionPOList = new ArrayList<>();
               for (Map.Entry<Integer, String> entry : courseTestFinishDTO.getQuestionIdAnswers().entrySet()) {
                   // key是questionId
                   // value是学生的answer
                   courseUserTestQuestionPOList.add(new CourseUserTestQuestionPO( courseTestFinishDTO.getUserId(),entry.getKey(), courseTestFinishDTO.getTestId(), entry.getValue()));
               }
               return courseUserTestQuestionPOList;
           }
       
           public CourseUserTestQuestionPO(int userId, int questionId, int testId, String answer) {
               this.userId = userId;
               this.questionId = questionId;
               this.testId = testId;
               this.answer = answer;
           }
       
       }
       ```
       
    6. **CourseOrder类**
    
       包含订单id、初始价格、实际价格、课程id、课程名字、订单创建时间、用户id、订单状态、课程使用权到期时间、课程购买类型
    
       ```java
       @Getter
       @Setter
       public class CourseOrder {
           private Integer id;
       
           private Integer origin;
       
           private Integer cost;
       
           private Integer courseId;
       
           private String courseName;
       
           private Date createTime;
       
           private Integer userId;
       
           private Integer status;
       
           // 课程使用权到期时间
           private Date endTime;
       
           // 0代表短期租用，1代表长期购买
           private PurchaseType purchaseType;
       
           public Date getEndTime() {
               return endTime;
           }
       
           public void setEndTime(Date endTime) {
               this.endTime = endTime;
           }
       
           public PurchaseType getPurchaseType() {
               return purchaseType;
           }
       
           public void setPurchaseType(PurchaseType purchaseType) {
               this.purchaseType = purchaseType;
           }
       
           public Integer getId() {
               return id;
           }
       
           public void setId(Integer id) {
               this.id = id;
           }
       
           public Integer getOrigin() {
               return origin;
           }
       
           public void setOrigin(Integer origin) {
               this.origin = origin;
           }
       
           public Integer getCost() {
               return cost;
           }
       
           public void setCost(Integer cost) {
               this.cost = cost;
           }
       
           public Integer getCourseId() {
               return courseId;
           }
       
           public void setCourseId(Integer courseId) {
               this.courseId = courseId;
           }
       
           public String getCourseName() {
               return courseName;
           }
       
           public void setCourseName(String courseName) {
               this.courseName = courseName == null ? null : courseName.trim();
           }
       
           public CourseOrder() {
           }
       
       
           public CourseOrder(Integer id, Integer origin, Integer cost, Integer courseId, String courseName, Date createTime, Integer userId, Integer status, Date endTime, PurchaseType purchaseType) {
               this.id = id;
               this.origin = origin;
               this.cost = cost;
               this.courseId = courseId;
               this.courseName = courseName;
               this.createTime = createTime;
               this.userId = userId;
               this.status = status;
               this.endTime = endTime;
               this.purchaseType = purchaseType;
           }
       
           public CourseOrder( Integer origin, Integer cost, Integer courseId, String courseName, Date createTime, Integer userId, Integer status, Date endTime, PurchaseType purchaseType) {
               this.origin = origin;
               this.cost = cost;
               this.courseId = courseId;
               this.courseName = courseName;
               this.createTime = createTime;
               this.userId = userId;
               this.status = status;
               this.endTime = endTime;
               this.purchaseType = purchaseType;
           }
       
           @Override
           public String toString() {
               return "CourseOrder{" +
                       "id=" + id +
                       ", origin=" + origin +
                       ", cost=" + cost +
                       ", courseId=" + courseId +
                       ", courseName='" + courseName + '\'' +
                       ", createTime=" + createTime +
                       ", userId=" + userId +
                       ", status=" + status +
                       ", endTime=" + endTime +
                       ", purchaseType=" + purchaseType +
                       '}';
           }
       
           public boolean isValid() {
               return status.equals(Constant.ORDER_STATUS_SUCCESS);
           }
       
           public boolean isOnRent() {
               return isValid() && purchaseType.equals(PurchaseType.Rent) && endTime.after(new Date());
           }
       
           public boolean isBought() {
               return isValid() && purchaseType.equals(PurchaseType.Buy);
           }
       
           public boolean isOk() {
               return isBought() || isOnRent();
           }
       }
       ```
    
    7. **PostPO类**
    
       包含帖子id、课程id、帖子发表用户id、帖子标题、帖子内容、帖子发表时间
    
       ```java
       public class PostPO {
           //帖子id
           int postId;
       
           //课程id
           int courseId;
       
           //帖子发表用户id
           int userId;
       
           //帖子标题
           String postTitle;
       
           //帖子内容
           String postContent;
       
           //帖子发表时间
           Date postTime;
       
       
           public PostPO() {
           }
       
           @Override
           public String toString() {
               return "PostPO{" +
                       "postId=" + postId +
                       ", courseId=" + courseId +
                       ", userId=" + userId +
                       ", postTitle='" + postTitle + '\'' +
                       ", postContent='" + postContent + '\'' +
                       ", postTime=" + postTime +
                       '}';
           }
       
           public PostPO(int postId, int courseId, int userId, String postTitle, String postContent, Date postTime) {
               this.postId = postId;
               this.courseId = courseId;
               this.userId = userId;
               this.postTitle = postTitle;
               this.postContent = postContent;
               this.postTime = postTime;
           }
           public PostPO(PostDTO postDTO){
               this.courseId=postDTO.getCourseId();
               this.userId=postDTO.getUserId();
               this.postTitle=postDTO.getTitle();
               this.postContent=postDTO.getContent();
               this.postTime=postDTO.getPostTime();
           }
       
           public int getPostId() {
               return postId;
           }
       
           public void setPostId(int postId) {
               this.postId = postId;
           }
       
           public int getCourseId() {
               return courseId;
           }
       
           public void setCourseId(int courseId) {
               this.courseId = courseId;
           }
       
           public int getUserId() {
               return userId;
           }
       
           public void setUserId(int userId) {
               this.userId = userId;
           }
       
           public String getPostTitle() {
               return postTitle;
           }
       
           public void setPostTitle(String postTitle) {
               this.postTitle = postTitle;
           }
       
           public String getPostContent() {
               return postContent;
           }
       
           public void setPostContent(String postContent) {
               this.postContent = postContent;
           }
       
           public Date getPostTime() {
               return postTime;
           }
       
           public void setPostTime(Date postTime) {
               this.postTime = postTime;
           }
       
           public PostPO(PostVO postVO) {
               this.postId =postVO.getPostId();
               this.courseId = postVO.getCourseId();
               this.userId = postVO.getUserId();
               this.postTitle = postVO.getPostTitle();
               this.postContent = postVO.getPostContent();
               this.postTime = postVO.getPostTime();
           }
       }
       ```
    
    8. **ReplyPO类**
    
       包含回复id、帖子id、发表回复的用户id、被回复的用户id、回复内容、被回复的评论的id、回复时间、回复状态
    
       ```java
       public class ReplyPO {
           //回复id
           int replyId;
       
           //回复的帖子id
           int postId;
       
           //发表回复的用户id
           int replyUserId;
       
           //被回复的用户id
           int repliedUserId;
       
           //回复内容
           String replyContent;
       
           //被回复的评论的id
           //如果是回复帖子，则是0。
           int repliedId;
       
           //回复时间
           Date replyTime;
       
           //该回复是否被用户查看过
           // 0代表没有被查看 1代表查看过了
           int status;
       
           public ReplyPO() {
           }
       
       
           public int getRepliedId() {
               return repliedId;
           }
       
           public void setRepliedId(int repliedId) {
               this.repliedId = repliedId;
           }
       
           public int getStatus() {
               return status;
           }
       
           public void setStatus(int status) {
               this.status = status;
           }
       
           public int getReplyId() {
               return replyId;
           }
       
           public void setReplyId(int replyId) {
               this.replyId = replyId;
           }
       
       
           public int getPostId() {
               return postId;
           }
       
           public void setPostId(int postId) {
               this.postId = postId;
           }
       
           public int getReplyUserId() {
               return replyUserId;
           }
       
           public void setReplyUserId(int replyUserId) {
               this.replyUserId = replyUserId;
           }
       
           public int getRepliedUserId() {
               return repliedUserId;
           }
       
           public void setRepliedUserId(int repliedUserId) {
               this.repliedUserId = repliedUserId;
           }
       
           public String getReplyContent() {
               return replyContent;
           }
       
           public void setReplyContent(String replyContent) {
               this.replyContent = replyContent;
           }
       
           public Date getReplyTime() {
               return replyTime;
           }
       
           public void setReplyTime(Date replyTime) {
               this.replyTime = replyTime;
           }
       
           public ReplyPO(int replyId, int postId, int replyUserId, int repliedUserId, String replyContent, int repliedId, Date replyTime, int status) {
               this.replyId = replyId;
               this.postId = postId;
               this.replyUserId = replyUserId;
               this.repliedUserId = repliedUserId;
               this.replyContent = replyContent;
               this.repliedId = repliedId;
               this.replyTime = replyTime;
               this.status = status;
           }
       
           public ReplyPO(ReplyDTO replyDTO){
             replyId=replyDTO.getReplyId();
             postId=replyDTO.getPostId();
             replyUserId=replyDTO.getReplyUserId();
             repliedId=replyDTO.getRepliedId();
             repliedUserId=replyDTO.getRepliedUserId();
             replyContent=replyDTO.getReplyContent();
             replyTime=replyDTO.getReplyTime();
             status=replyDTO.getStatus();
           }
       
           @Override
           public String toString() {
               return "ReplyPO{" +
                       "replyId=" + replyId +
                       ", postId=" + postId +
                       ", replyUserId=" + replyUserId +
                       ", repliedUserId=" + repliedUserId +
                       ", replyContent='" + replyContent + '\'' +
                       ", repliedId=" + repliedId +
                       ", replyTime=" + replyTime +
                       ", status=" + status +
                       '}';
           }
       
       
           public ReplyPO(ReplyVO replyVO) {
               this.replyId = replyVO.getReplyId();
               this.postId = replyVO.getPostId();
               this.replyUserId = replyVO.getReplyUserId();
               this.repliedUserId = replyVO.getRepliedUserId();
               this.replyContent = replyVO.getReplyContent();
               this.repliedId = replyVO.getRepliedId();
               this.replyTime = replyVO.getReplyTime();
               this.status = replyVO.getStatus();
           }
       }
       ```
    
    9. **User类**
    
       包含用户id、昵称、手机号码、密码、头像图片、账户余额、用户身份、账户创建时间、是否是vip、vip到期时间
    
       ```java
       @Getter
       @Setter
       public class User {
           private Integer id;
       
           private String uname;
       
           private String phone;
       
           private String password;
       
           private String picture;
       
           private Integer balance;
       
           private UserRole userRole;
       
           private Date createTime;
       
           // 0代表不是vip，1代表是vip
           private int isVip;
       
           // vip到期时间
           private Date vipEndTime;
       
           public Date getVipEndTime() {
               return vipEndTime;
           }
       
           public void setVipEndTime(Date vipEndTime) {
               this.vipEndTime = vipEndTime;
           }
       
           public Integer getId() {
               return id;
           }
       
           public void setId(Integer id) {
               this.id = id;
           }
       
           public String getUname() {
               return uname;
           }
       
           public void setUname(String uname) {
               this.uname = uname == null ? null : uname.trim();
           }
       
           public String getPhone() {
               return phone;
           }
       
           public void setPhone(String phone) {
               this.phone = phone == null ? null : phone.trim();
           }
       
           public String getPassword() {
               return password;
           }
       
           public void setPassword(String password) {
               this.password = password == null ? null : password.trim();
           }
       
       
           public User() {
           }
       
           public User(Integer id, String uname, String phone, String password, String picture, Integer balance, UserRole userRole, Date createTime, int isVip, Date vipEndTime) {
               this.id = id;
               this.uname = uname;
               this.phone = phone;
               this.password = password;
               this.picture = picture;
               this.balance = balance;
               this.userRole = userRole;
               this.createTime = createTime;
               this.isVip = isVip;
               this.vipEndTime = vipEndTime;
           }
       
           public int getIsVip() {
               return isVip;
           }
       
           public void setIsVip(int isVip) {
               this.isVip = isVip;
           }
       
       
           public User(UserVO userVO){
               id = userVO.getId();
               uname = userVO.getUname();
               phone = userVO.getPhone();
               password = userVO.getPassword();
               picture = userVO.getPicture();
               balance = userVO.getBalance();
               userRole = userVO.getUserRole();
               createTime = userVO.getCreateTime();
               isVip=userVO.getIsVip();
               vipEndTime=userVO.getVipEndTime();
           }
       
           public void becomeVip() {
               this.isVip = 1;
           }
       
           @Override
           public String toString() {
               return "User{" +
                       "id=" + id +
                       ", uname='" + uname + '\'' +
                       ", phone='" + phone + '\'' +
                       ", password='" + password + '\'' +
                       ", picture='" + picture + '\'' +
                       ", balance=" + balance +
                       ", userRole=" + userRole +
                       ", createTime=" + createTime +
                       ", isVip=" + isVip +
                       ", vipEndTime=" + vipEndTime +
                       '}';
           }
       }
       ```
    
       